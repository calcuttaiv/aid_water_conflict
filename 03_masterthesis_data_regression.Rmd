---
title: "masterthesis_regression"
author: "Lê Minh Hoàng"
date: "2024-08-22"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Packages

```{r cars}
if (!requireNamespace("pacman", quietly = TRUE)) {
  install.packages("pacman")
}

pacman::p_load(
  fixest, haven, modelsummary, tidyverse, readxl, dplyr, plm, stargazer, IDPmisc, lfe, here, sandwich, AER, 
  dynlm, forecast, scales, nlme, lmtest, pdynmc, dynpanel, rstudioapi, xtable, estimatr, zoo, skimr, rvest, 
  exactextractr, sf, raster, geodata, stringr, parallel, osmdata, osmextract, wbstats, spatialreg, spData, 
  spdep, leaflet, RColorBrewer, ncdf4, rnaturalearth, patchwork, WDI, httr, jsonlite, tidytext, lintr, 
  pdftools, purrr, gt, kableExtra
)
```

# Load the data
## 50 by 50 grid
```{r}
grid_final_afg_50_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_afg_50.rds")
grid_final_bgd_50_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_bgd_50.rds")
grid_final_btn_50_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_btn_50.rds")
grid_final_ind_50_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_ind_50.rds")
# grid_final_ind_df  <- grid_final_ind_df %>%
#   dplyr::select(-total_disbur, -log_disbur)
grid_final_npl_50_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_npl_50.rds")
grid_final_pak_50_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_pak_50.rds")
grid_final_lka_50_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_lka_50.rds")

# Afghanistan
grid_final_afg_50_df <- grid_final_afg_50_df %>%
  mutate(grid_id = paste0(grid_id, "_afg"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_afg_50_df_1995 <- grid_final_afg_50_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Bangladesh
grid_final_bgd_50_df <- grid_final_bgd_50_df %>%
  mutate(grid_id = paste0(grid_id, "_bgd"),
         GID_0 = substr(GID_1, 1, 3))

grid_final_bgd_50_df_1995 <- grid_final_bgd_50_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Bhutan
grid_final_btn_50_df <- grid_final_btn_50_df %>%
  mutate(grid_id = paste0(grid_id, "_btn"),
         GID_0 = substr(GID_1, 1, 3))

grid_final_btn_50_df_1995 <- grid_final_btn_50_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# India
grid_final_ind_50_df <- grid_final_ind_50_df %>%
  mutate(grid_id = paste0(grid_id, "_ind"),
         GID_0 = substr(GID_1, 1, 3))

grid_final_ind_50_df_1995 <- grid_final_ind_50_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Nepal
grid_final_npl_50_df <- grid_final_npl_50_df %>%
  mutate(grid_id = paste0(grid_id, "_npl"),
         GID_0 = substr(GID_1, 1, 3))

grid_final_npl_50_df_1995 <- grid_final_npl_50_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Pakistan
grid_final_pak_50_df <- grid_final_pak_50_df %>%
  mutate(grid_id = paste0(grid_id, "_pak"),
         GID_0 = substr(GID_1, 1, 3))

grid_final_pak_50_df_1995 <- grid_final_pak_50_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Sri Lanka
grid_final_lka_50_df <- grid_final_lka_50_df %>%
  mutate(grid_id = paste0(grid_id, "_lka"),
         GID_0 = substr(GID_1, 1, 3))

grid_final_lka_50_df_1995 <- grid_final_lka_50_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# bind all of those dataframe together
grid_final_south_asia_50_df_1995 <- bind_rows(
  grid_final_afg_50_df_1995,
  grid_final_bgd_50_df_1995,
  grid_final_btn_50_df_1995,
  grid_final_ind_50_df_1995,
  grid_final_npl_50_df_1995,
  grid_final_pak_50_df_1995,
  grid_final_lka_50_df_1995
)

# add GID_0 to grid_final_south_asia_df based on the first three later in the value of GID_1
grid_final_south_asia_50_df_1995 <- grid_final_south_asia_50_df_1995 %>%
  mutate(GID_0 = substr(GID_1, 1, 3))

summary(as.factor(grid_final_ind_50_df$GID_0))

```


## 25 by 25 grid
robustness check
```{r}
grid_final_afg_25_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_afg_25.rds")
grid_final_bgd_25_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_bgd_25.rds")
grid_final_btn_25_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_btn_25.rds")
grid_final_ind_25_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_ind_25.rds")
# grid_final_ind_df  <- grid_final_ind_df %>%
#   dplyr::select(-total_disbur, -log_disbur)
grid_final_npl_25_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_npl_25.rds")
grid_final_pak_25_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_pak_25.rds")
grid_final_lka_25_df <- read_rds("./Data/data-r4r/grid_df_incomplete_cells_lka_25.rds")

# Afghanistan
grid_final_afg_25_df <- grid_final_afg_25_df %>%
  mutate(grid_id = paste0(grid_id, "_afg"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_afg_25_df_1995 <- grid_final_afg_25_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Bangladesh
grid_final_bgd_25_df <- grid_final_bgd_25_df %>%
  mutate(grid_id = paste0(grid_id, "_bgd"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_bgd_25_df_1995 <- grid_final_bgd_25_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Bhutan
grid_final_btn_25_df <- grid_final_btn_25_df %>%
  mutate(grid_id = paste0(grid_id, "_btn"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_btn_25_df_1995 <- grid_final_btn_25_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# India
grid_final_ind_25_df <- grid_final_ind_25_df %>%
  mutate(grid_id = paste0(grid_id, "_ind"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_ind_25_df_1995 <- grid_final_ind_25_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Nepal
grid_final_npl_25_df <- grid_final_npl_25_df %>%
  mutate(grid_id = paste0(grid_id, "_npl"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_npl_25_df_1995 <- grid_final_npl_25_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Pakistan
grid_final_pak_25_df <- grid_final_pak_25_df %>%
  mutate(grid_id = paste0(grid_id, "_pak"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_pak_25_df_1995 <- grid_final_pak_25_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# Sri Lanka
grid_final_lka_25_df <- grid_final_lka_25_df %>%
  mutate(grid_id = paste0(grid_id, "_lka"), 
         GID_0 = substr(GID_1, 1, 3))

grid_final_lka_25_df_1995 <- grid_final_lka_25_df %>%
  mutate(year = as.numeric(as.character(year))) %>%
  filter(year >= 1995)

# bind all of those dataframe together
grid_final_south_asia_25_df_1995 <- bind_rows(
  grid_final_afg_25_df_1995,
  grid_final_bgd_25_df_1995,
  grid_final_btn_25_df_1995,
  grid_final_ind_25_df_1995,
  grid_final_npl_25_df_1995,
  grid_final_pak_25_df_1995,
  grid_final_lka_25_df_1995
)

# add GID_0 to grid_final_south_asia_df based on the first three later in the value of GID_1
grid_final_south_asia_25_df_1995 <- grid_final_south_asia_25_df_1995 %>%
  mutate(GID_0 = substr(GID_1, 1, 3))

summary(as.factor(grid_final_ind_25_df$GID_0))
```

# Check
This code is not meant to be run by reviewer
check for the earliest year that conflict happens (conflicts_count > 0) for grid_final_pak_50_df
check for the earliest year that conflict happens (conflicts_count > 0) for grid_final_pak_50_df
```{r}
# # Convert year to numeric if it's a factor
# grid_final_pak_50_df <- grid_final_pak_50_df %>%
#   mutate(year = as.numeric(as.character(year)))
# 
# # Filter for rows where conflicts_count > 0 and find the minimum year
# earliest_conflict_year <- grid_final_pak_50_df %>%
#   filter(project_location_count > 0) %>%
#   summarise(min_year = min(year, na.rm = TRUE))
# 
# # Print the result
# print(earliest_conflict_year)
```
# Summary Statistics

```{r}
library(modelsummary)
library(gt)

desc_stat_ind <- grid_final_ind_50_df_1995 %>%
  mutate(conflict_dummy = conflict_dummy * 100,
         state_based_dummy = ifelse(state_based_count > 0, 100, 0),
         non_state_dummy = ifelse(non_state_count > 0, 100, 0),
         one_sided_dummy = ifelse(one_sided_count >0, 100, 0))
# Generate summary statistics without n_unique
summary_stats <- datasummary((conflict_dummy + state_based_dummy  + non_state_dummy + one_sided_dummy + log(best_death_count + 1)  + project_location_count + bws_cat + log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage) ~ 
                            N + mean + P25 + P75 + sd + min + median + max, 
                            fmt = 3, 
                            data = desc_stat_ind, 
                            output = "gt")

# # Further formatting with gt, making N the first column
# summary_stats_formatted <- summary_stats %>%
#   tab_header(
#     title = "Descriptive Statistics of Key Variables",
#     subtitle = "Data from grid_final_ind_50_df_1995"
#   ) %>%
#   fmt_number(columns = c(mean, sd, min, median, max), decimals = 3) %>%
#   fmt_number(columns = c(N), decimals = 0) %>%
#   cols_label(
#     N = "Obs",
#     mean = "Mean",
#     sd = "Std",
#     min = "Min",
#     median = "Median",
#     max = "Max"
#   ) %>%
#   cols_move(columns = N, after = max) %>% # Move 'N' to the front
#   cols_move(columns = c(mean, sd, min, median, max), after = N) %>%
#   tab_spanner(
#     label = "Descriptive Statistics",
#     columns = c(N, mean, sd, min, median, max)
#   ) %>%
#   tab_style(
#     style = list(
#       cell_text(weight = "bold")
#     ),
#     locations = cells_column_labels(columns = everything())
#   ) %>%
#   tab_options(
#     table.width = pct(100),
#     column_labels.font.weight = "bold"
#   )

# Further formatting with gt, moving N to the front and including P25/P75
summary_stats_formatted <- summary_stats %>%
  tab_header(
    title = "Descriptive Statistics of Key Variables",
    subtitle = "Data from grid_final_ind_50_df_1995"
  ) %>%
  fmt_number(columns = c(mean, sd, min, P25, median, P75, max), decimals = 3) %>% # Format all numeric columns
  fmt_number(columns = c(N), decimals = 0) %>% # Format N with no decimals
  cols_label(
    N = "Obs",
    mean = "Mean",
    sd = "Std",
    min = "Min",
    P25 = "1Q",      # First quartile
    median = "Median",
    P75 = "3Q",      # Third quartile
    max = "Max"
  ) %>%
  cols_move(columns = N, after = max) %>% # Move 'Obs' to the front
  cols_move(columns = c(mean, sd, min, P25, median, P75, max), after = N) %>% # Order: Mean, Std, Min, 1Q, Median, 3Q, Max
  tab_spanner(
    label = "Descriptive Statistics",
    columns = c(N, mean, sd, min, P25, median, P75, max)
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(columns = everything())
  ) %>%
  tab_options(
    table.width = pct(100),
    column_labels.font.weight = "bold"
  )

summary_stats_formatted

# Convert gt table to LaTeX
latex_code <- as_latex(summary_stats_formatted)

# Write the LaTeX code to a file
gtsave(summary_stats_formatted, "./latex/descriptive_stats_from_gt.tex") # Save as LaTeX if needed
```

# Regressions
## Set rule for postprocess (latex)
```{r}
postprocess_depvar <- function(x) {
  process_name <- function(name) {
    name <- sub("^\\s*\\d+\\*", "", name)
    name <- sub("^\\s*I\\(([^>]+)>0\\)", "\\1", name)
    if (grepl("^\\s*log\\(([^)]+)\\+1\\)", name)) {
      name <- sub("^\\s*log\\(([^)]+)\\+1\\)", "Log of \\1", name)
    }
    name <- gsub("\\\\_", " ", name)
    name <- gsub("\\b(\\w)", "\\U\\1", name, perl = TRUE)
    return(trimws(name))
  }
  
  for (i in seq_along(x)) {
    if (grepl("^\\s*Dependent Variable[s]?:", x[i])) {
      row <- sub("\\\\\\s*$", "", x[i])
      cols <- strsplit(row, "&")[[1]]
      for (j in 2:length(cols)) {
        orig_name <- trimws(cols[j])
        if (nchar(orig_name) > 0) {
          cols[j] <- process_name(orig_name)
        }
      }
      x[i] <- paste(cols, collapse = "&")
      x[i] <- paste0(x[i], "\\\\")
    }
    
    if (grepl("^\\s*grid\\\\_id\\s*&", x[i])) {
      x[i] <- sub("^\\s*grid\\\\_id\\s*&", "Grid Cell &", x[i])
    }
    if (grepl("^\\s*GID\\\\_2-year\\s*&", x[i])) {
      x[i] <- sub("^\\s*GID\\\\_2-year\\s*&", "Subdistrict * Year &", x[i])
    }
    
    if (grepl("^\\\\begin\\{tabular\\}", x[i])) {
      x[i] <- paste("\\small", x[i], sep = "\n")
    }
  }
  return(x)
}

# Define a dictionary for renaming variables
fixest::setFixest_dict(c(
  project_location_count = "Project Location Count",
  "log_gdp" = "Log GDP",
  "log_pop" = "Log Population",
  "avg_temp" = "Average Temperature",
  "avg_prec" = "Average Precipitation",
  "cropland_percentage" = "Cropland Percentage",
  "bws_cat::1" = "Water Stress Level 1",
  "bws_cat::2" = "Water Stress Level 2",
  "bws_cat::3" = "Water Stress Level 3",
  "bws_cat::4" = "Water Stress Level 4"
))
```

## India
### 50 km
```{r}
final_results_india <- feols(
  c(100*conflict_dummy, 
    100*I(state_based_count > 0),
    100*I(non_state_count > 0),
    100*I(one_sided_count > 0),
    best_death_count, log(best_death_count + 1), log(conflicts_count + 1),
    log(state_based_count+1), log(non_state_count + 1), log(one_sided_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_ind_50_df_1995
)

etable(final_results_india, 
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_ind_50_rotated.tex"
)

results_india_main <- feols(100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_ind_50_df_1995
)



etable_results_india_main <- etable(results_india_main, 
                               signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
                               tex = TRUE,
                               cluster = ~grid_id,
                               postprocess.tex = postprocess_depvar,
                               file = "./latex/reg_ind_50_conflict_dummy.tex")

results_india_aux <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0), 
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_ind_50_df_1995
)

etable_results_india_aux <- etable(results_india_aux, 
                               signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
                               tex = TRUE,
                               cluster = ~grid_id,
                               postprocess.tex = postprocess_depvar,
                               file = "./latex/reg_ind_50_aux.tex")

```

### 25 km
```{r}
final_results_india_25 <- feols(
  c(100*conflict_dummy, 
    100*I(state_based_count > 0),
    100*I(non_state_count > 0),
    100*I(one_sided_count > 0),
    best_death_count, log(best_death_count + 1), log(conflicts_count + 1),
    log(state_based_count+1), log(non_state_count + 1), log(one_sided_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_ind_25_df_1995
)

etable(final_results_india_25, 
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id
)

# Define a dictionary for renaming variables
fixest::setFixest_dict(c(
  project_location_count = "Project Location Count",
  "log_gdp" = "Log GDP",
  "log_pop" = "Log Population",
  "avg_temp" = "Average Temperature",
  "avg_prec" = "Average Precipitation",
  "cropland_percentage" = "Cropland Percentage",
  "bws_cat::1" = "Water Stress Level 1",
  "bws_cat::2" = "Water Stress Level 2",
  "bws_cat::3" = "Water Stress Level 3",
  "bws_cat::4" = "Water Stress Level 4"
))

results_india_25_main <- feols(100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_ind_25_df_1995
)



etable_results_india_25_main <- etable(results_india_25_main, 
                               signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
                               tex = TRUE,
                               cluster = ~grid_id,
                               postprocess.tex = postprocess_depvar,
                               file = "./latex/reg_ind_50_conflict_dummy.tex")

results_india_25_aux <- feols(
  c(100*conflict_dummy,
    100*I(state_based_count > 0),
    100*I(non_state_count > 0),
    100*I(one_sided_count > 0), 
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_ind_25_df_1995
)

etable_results_india_25_aux <- etable(results_india_25_aux, 
                               signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
                               tex = TRUE,
                               cluster = ~grid_id,
                               postprocess.tex = postprocess_depvar,
                               file = "./latex/reg_ind_25_aux.tex")
```
## External validity
### 50 km
```{r}
final_result_afg_conflict_dumm <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_afg_50_df_1995
)

final_result_bgd_conflict_dumm <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_bgd_50_df_1995
)

final_result_npl_conflict_dumm <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_npl_50_df_1995
)

final_result_pak_conflict_dumm <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_pak_50_df_1995
)

etable(final_result_afg_conflict_dumm,
       final_result_bgd_conflict_dumm,
       final_result_npl_conflict_dumm,
       final_result_pak_conflict_dumm,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_50_conflict_dummy.tex"
)
```
#### Auxiliary depndent variables
##### Afghanistan
```{r}
final_result_afg_50_aux <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_afg_50_df_1995
)

etable(final_result_afg_aux,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_50_afg_aux.tex"
)
```

##### Bangladesh
```{r}
final_result_bgd_50_aux <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_bgd_50_df_1995
)

etable(final_result_bgd_50_aux,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_50_bgd_aux.tex"
)
```

##### Nepal
```{r}
final_result_npl_50_aux <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_npl_50_df_1995
)

etable(final_result_npl_50_aux,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_50_npl_aux.tex"
)
```

##### Pakistan
```{r}
final_result_pak_50_aux <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_pak_50_df_1995
)

etable(final_result_pak_50_aux,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_50_pak_aux.tex"
)
```

##### Sri Lanka
```{r}
final_result_lka_50_aux <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_lka_50_df_1995
)

etable(final_result_lka_50_aux,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_50_lka_aux.tex"
)
```
### 25 km 
#### Conflict dummy
```{r}
final_result_afg_conflict_dumm_25 <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_afg_25_df_1995
)

final_result_bgd_conflict_dumm_25 <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_bgd_25_df_1995
)

final_result_npl_conflict_dumm_25 <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_npl_25_df_1995
)

final_result_pak_conflict_dumm_25 <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_pak_25_df_1995
)

final_result_lka_conflict_dumm_25 <- feols(
  100*conflict_dummy ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_lka_25_df_1995
)

etable(final_result_afg_conflict_dumm_25,
       final_result_bgd_conflict_dumm_25,
       final_result_npl_conflict_dumm_25,
       final_result_pak_conflict_dumm_25,
       final_result_lka_conflict_dumm_25,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_25_conflict_dummy.tex"
)


```
#### Auxiliary depndent variables
##### Afghanistan
```{r}
final_result_afg_aux_25 <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_afg_25_df_1995
)

etable(final_result_afg_aux_25,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_25_afg_aux.tex"
)
```

##### Bangladesh
```{r}
final_result_bgd_aux_25 <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_bgd_25_df_1995
)

etable(final_result_bgd_aux_25,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_25_bgd_aux.tex"
)
```

##### Nepal
```{r}
final_result_npl_aux_25 <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_npl_25_df_1995
)

etable(final_result_npl_aux_25,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_25_npl_aux.tex"
)
```

##### Pakistan
```{r}
final_result_pak_aux_25 <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_pak_25_df_1995
)

etable(final_result_pak_aux_25,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_25_pak_aux.tex"
)
```

##### Sri Lanka
```{r}
final_result_lka_aux_25 <- feols(
  c(100*I(state_based_count > 0),
    100*I(one_sided_count > 0),
    100*I(non_state_count > 0),
    log(best_death_count + 1)) ~ project_location_count + i(
    bws_cat,
    project_location_count,
    ref = 0,
    ref2 = 0
  )  +
  #i(project_location_water_dummy, project_location_count, ref = 0)+
  log_gdp + log_pop + avg_temp + avg_prec + cropland_percentage | grid_id + GID_2^year,
  data = grid_final_lka_25_df_1995
)

etable(final_result_lka_aux_25,
       signif.code = c("***" = 0.01, "**" = 0.05, "*" = 0.1, "." = 0.2),
       cluster = ~grid_id,
       tex = T,
       postprocess.tex = postprocess_depvar,
       file = "./latex/reg_exte_valu_25_lka_aux.tex"
)
```
# Saving the environement
```{r pressure, echo=FALSE}
base::save.image(file = "./streamlined_v2.RData")
```